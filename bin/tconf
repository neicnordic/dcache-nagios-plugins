#! /usr/bin/env python
import os, sys
from getopt import gnu_getopt, GetoptError
_bindir = os.path.dirname(__file__)
_pyver = "%d.%d"%sys.version_info[0:2]
sys.path.insert(0, os.path.join(_bindir, '../lib/python%s'%_pyver))
sys.path.insert(0, os.path.join(_bindir, '../pylib'))
from ndgf_nagios.tconf import load_tconf, TconfTemplateVisitor

usage = """
Usage: tconf [OPTIONS] INPUT.tconf

Options:
    --help		Yes.
    -I DIR		Prepend DIR to the list of directories searched
			for templates.
"""

template_dirs = []
try:
    opts, args = gnu_getopt(sys.argv[1:], 'I:', ['help'])
    for opt, arg in opts:
	if opt == '--help':
	    sys.stdout.write(usage)
	    sys.exit(0)
	elif opt == '-I':
	    template_dirs.insert(0, arg)
	else:
	    assert False
    if len(args) != 1:
	raise GetoptError("Expecting a single non-option argument.")
except GetoptError, err:
    sys.stderr.write('%s\nNeed --help?\n'%err)
    sys.exit(os.EX_USAGE)

visitor = TconfTemplateVisitor(template_dirs = template_dirs)
load_tconf(args[0], visitor)
